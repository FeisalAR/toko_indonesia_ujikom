<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman CRUD</title>
    <script src="js/jquery-3.5.1.js"></script>
    <script>
        $(function() {
            all();
        });

        function all() {
            $.ajax({
                url: 'http://localhost/ujikom-p/pengarang/all'
            }).then(function(data) {
                var row = '';
                $.each(data, function(id, pengarang) {
                    row += `
						<tr>
							<td onclick="prepareUpdate('${pengarang.id}')">${pengarang.id}</td>
							<td>${pengarang.nama}</td>
							<td>${pengarang.email}</td>
						</tr>
					`
                });
                $('#rows').append(row);
            });
        }
    </script>
</head>

<body>
    <table>
        <thead>
            <th>ID</th>
            <th>Nama</th>
            <th>email</th>
        </thead>
        <tbody id="rows">

        </tbody>
    </table>


    <form id="form-crud">
        <input type="hidden" name="id" id="id"><br> Nama : <input type="text" name="nama" id="nama"><br> Email : <input type="text" name="email" id="email"><br>
        <button onclick="insertOrUpdate()" type="button">Simpan</button>
        <button onclick="hapus()" type="button">Hapus</button>
        <input id="reset" type="reset" value="Reset">



    </form>



    <script>
        var isNew = true;

        // function insert() {

        // }

        function prepareUpdate(id) {
            isNew = false
            $.ajax({
                url: "http://localhost/ujikom-p/pengarang/byid?id=" + id
            }).then(function(data) {
                $('#id').val(data.id)
                $('#nama').val(data.nama)
                $('#email').val(data.email)
            })
        } //end prepareupdate

        function insertOrUpdate() {
            if (isNew) {
                $.ajax({
                    url: "http://localhost/ujikom-p/pengarang/insert",
                    type: 'POST',
                    data: `nama=${$('#nama').val()}&email=${$('#email').val()}`
                }).then(function(data) {
                    console.log(data);
                    $('#rows').empty()
                    all()
                    $('#reset').trigger('click');
                });
            } else {
                $.ajax({
                    url: "http://localhost/ujikom-p/pengarang/update",
                    type: 'POST',
                    data: `nama=${$('#nama').val()}&email=${$('#email').val()}&id=${$('#id').val()}`
                }).then(function(data) {
                    console.log(data);
                    $('#rows').empty()
                    all()
                });
            }

            isNew = true
            $('#reset').trigger('click');
        } //end insertorupdate


        function hapus() {
            if (confirm('Hapus data?')) {
                $.ajax({
                    url: "http://localhost/ujikom-p/pengarang/delete",
                    type: 'POST',
                    data: `id=${$('#id').val()}`
                }).then(function(data) {
                    console.log(data);
                    $('#rows').empty()
                    all()
                    $('#reset').trigger('click');
                });
            }
        }
    </script>

</body>

</html>